services:
  rag_postgres:
    image: pgvector/pgvector:pg16
    container_name: rag_postgres
    restart: unless-stopped
    environment:
      POSTGRES_USER: admin
      POSTGRES_PASSWORD: admin
      POSTGRES_DB: aurora_hotel
      TZ: Asia/Ho_Chi_Minh
    ports:
      - "5432:5432"
    volumes:
      - rag_pgdata:/var/lib/postgresql/data
      - ./src/main/resources/db/init.sql:/docker-entrypoint-initdb.d/init.sql
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U admin -d aurora_hotel"]
      interval: 10s
      timeout: 5s
      retries: 5

  pgadmin:
    image: dpage/pgadmin4:8
    container_name: aurora_pgadmin
    restart: unless-stopped
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@gmail.com
      PGADMIN_DEFAULT_PASSWORD: admin
    ports:
      - "5050:80"
    depends_on:
      - rag_postgres

  redis:
    image: redis:7.2-alpine
    container_name: aurora-redis
    restart: unless-stopped
    environment:
      TZ: Asia/Ho_Chi_Minh
    ports:
      - "6379:6379"
    volumes:
      - redis_data:/data
    command: redis-server --appendonly yes --requirepass admin
    healthcheck:
      test: ["CMD", "redis-cli", "-a", "admin", "ping"]
      interval: 10s
      timeout: 3s
      retries: 3

  redisinsight:
    image: redis/redisinsight:latest
    container_name: aurora_redisinsight
    restart: unless-stopped
    ports:
      - "8001:5540"
    volumes:
      - redisinsight_data:/data
    environment:
      RITRUSTEDORIGINS: "http://localhost:8001,http://127.0.0.1:8001"
    depends_on:
      - redis

volumes:
  rag_pgdata:
  redis_data:
  redisinsight_data:

# =============================================================================
# QUICK START
# =============================================================================
# docker-compose up -d

# =============================================================================
# DOCKER COMMANDS
# =============================================================================
# docker-compose up -d          # Start all services
# docker-compose down           # Stop all services
# docker-compose down -v        # Stop and remove all data
# docker-compose ps             # Check status
# docker-compose logs -f        # View all logs
# docker-compose logs -f <service>  # View specific service logs

# =============================================================================
# DATABASE MANAGEMENT TOOLS
# =============================================================================

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ PostgreSQL + pgAdmin                                                    │
# ├─────────────────────────────────────────────────────────────────────────┤
# │ URL:        http://localhost:5050                                       │
# │ Email:      admin@gmail.com                                             │
# │ Password:   admin                                                       │
# │                                                                         │
# │ Connection (from pgAdmin):                                              │
# │   Host:     rag_postgres (or localhost)                                 │
# │   Port:     5432                                                        │
# │   Database: aurora_hotel                                                │
# │   Username: admin                                                       │
# │   Password: admin                                                       │
# └─────────────────────────────────────────────────────────────────────────┘

# ┌─────────────────────────────────────────────────────────────────────────┐
# │ Redis + Redis Insight                                                   │
# ├─────────────────────────────────────────────────────────────────────────┤
# │ URL:        http://localhost:8001                                       │
# │ Password:   admin                                                       │
# │                                                                         │
# │ Connection (from Redis Insight):                                        │
# │   Host:     aurora-redis (or localhost)                                 │
# │   Port:     6379                                                        │
# │   Password: admin                                                       │
# │                                                                         │
# │ Features: Browse keys, edit values, view memory, run commands, etc.     │
# └─────────────────────────────────────────────────────────────────────────┘
